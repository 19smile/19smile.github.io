"use strict";(self["webpackChunktenant_portal"]=self["webpackChunktenant_portal"]||[]).push([[980],{980:function(t,e,n){n.r(e),n.d(e,{default:function(){return g}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"content"},[t._m(0),t._m(1),e("div",{staticClass:"pt-16"},[e("van-sticky",{attrs:{"offset-top":48}},[e("van-row",{staticClass:"select-box",attrs:{gutter:"6"}},[e("van-col",{attrs:{span:"12"}},[e("span",{on:{click:function(e){t.show=!0}}},[t._v("Select BU |")]),e("span",{staticClass:"ml-8",on:{click:function(e){t.show=!0}}},[t._v(t._s(t.selBu))]),e("img",{attrs:{width:"24px",src:n(597)},on:{click:function(e){t.show=!0}}})]),e("van-col",{staticClass:"justify-end",attrs:{span:"12"}},[e("div",{staticClass:"sel-month"},[e("span",{on:{click:function(e){t.showMonth=!0}}},[t._v(t._s(t.selMonth))]),e("img",{attrs:{width:"24px",src:n(597)},on:{click:function(e){t.showMonth=!0}}})])])],1)],1),e("van-action-sheet",{attrs:{title:"Select BU",round:!1,actions:t.buList},on:{select:t.onSelect},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}}),e("van-action-sheet",{attrs:{round:!1},model:{value:t.showMonth,callback:function(e){t.showMonth=e},expression:"showMonth"}},[e("van-datetime-picker",{attrs:{"min-date":t.minDate,type:"year-month",formatter:t.formatter},on:{confirm:t.confirm,cancel:function(e){t.showMonth=!1}},model:{value:t.currentDate,callback:function(e){t.currentDate=e},expression:"currentDate"}})],1)],1),e("div",{staticClass:"content-items"},[e("div",{staticClass:"content-items-content"},[t._m(2),e("div",{staticClass:"card-list fs-14"},[t._l(t.leaveDTLSickItems,(function(n,s){return[s<10?e("van-row",{key:n.id,staticClass:"card-list-content",attrs:{gutter:"8"}},[e("van-col",{staticClass:"card-list-left",attrs:{span:"18"}},[e("div",{staticClass:"card-list-left-content"},[e("div",{staticClass:"card-list-left-logo"},[e("img",{attrs:{width:"100%",src:t.getEmployee(n)?.img_url}})]),e("div",{staticClass:"card-list-left-text"},[e("p",[t._v(t._s(t.getEmployee(n)?.name_en))]),e("p",{staticClass:"fs-12"},[t._v(t._s(t.getEmployee(n)?.dept_code))])])])]),e("van-col",{staticClass:"card-list-right text-right fs-16 fw-600",class:["text-danger2"],attrs:{span:"6"}},[t._v(" "+t._s(n.leave_days)+"D/12D ")])],1):t._e()]}))],2)])])])},a=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"content-items"},[e("div",{staticClass:"content-items-content"},[e("div",{staticClass:"content-items-title"},[e("img",{attrs:{width:"24px",src:n(5513)}}),e("span",[t._v("Monthy Leave")])]),e("div",{staticClass:"monthy"},[e("div",{staticClass:"monthy-bar",attrs:{id:"monthyBar"}})])])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"content-items"},[e("div",{staticClass:"content-items-content"},[e("div",{staticClass:"content-items-title"},[e("img",{attrs:{width:"24px",src:n(5683)}}),e("span",[t._v("Sick Leave")])]),e("div",{staticClass:"monthy"},[e("div",{staticClass:"monthy-bar",attrs:{id:"sickBar"}})])])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"content-items-title"},[e("img",{attrs:{width:"24px",src:n(1042)}}),e("span",[t._v("Abnormal Sick Leave")])])}],o=(n(4114),n(7349)),r=n(3011),i=n(7691),c=n(9941),l=n(7967),h=n(2407),u=n(8193),m={name:"attendanceCoreKPI",components:{Row:o.A,Col:r.A,Swipe:i.A,SwipeItem:c.A,ActionSheet:l.A},data(){const t={common:{pageNum:1,pageSize:2e3,returnTotalNum:"true"}};return{...t,show:!1,minDate:new Date("1970-01-01"),currentDate:new Date,showMonth:!1,colors:(0,h.zB)(),leaveDTLMonth:[],leaveDTL:[],selBu:"",selMonth:(0,h.n7)(new Date,"month"),selMonthN:(0,h.n7)(new Date,"normalDay2")}},computed:{leaveDTLMonthItems(){const t={};return this.leaveDTLMonth.forEach((e=>{t[e.the_month]=t[e.the_month]||[],t[e.the_month].push(e)})),t},employeeList(){return this.hrEmployee.filter((t=>{const e=(0,h.n7)(t.resign_date,"monthN"),n=(0,h.n7)(new Date((new Date).setMonth((new Date).getMonth()+1)),"monthN");if(e>=n||!t.resign_date)return t}))},leaveDTLSick(){return this.leaveDTL.filter((t=>"Sick Leave"===t.leave_code))},leaveDTLSickItems(){return this.leaveDTLSick.sort(((t,e)=>t.leave_days<e.leave_days?1:-1))}},created(){this.$nextTick((()=>{this.selBu=this.buList?.[0]?.value,this.setEchars()}))},watch:{},methods:{getLastSixMonths:h.a5,getDaysInCurrentMonth:h.y7,getEmployee(t){return this.hrEmployee.filter((e=>e.emp_id===t.emp_id))?.[0]},async setEchars(t){await this.getLeaveByMonth(),await this.getLeaveDTL(),this.getMonthyBar("monthyBar",!0),this.getMonthyBar("sickBar",!0),this.observer=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting?this.getMonthyBar("monthyBar",!0):this.getMonthyBar("monthyBar",!1)}))})),this.observer.observe(document.getElementById("monthyBar")),this.observer2=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting?this.getMonthyBar("sickBar",!0):this.getMonthyBar("sickBar",!1)}))})),this.observer2.observe(document.getElementById("sickBar"))},async getLeaveByMonth(){const t=await u.VD({...this.$options.data().common,begin_month:(0,h.n7)(new Date((new Date).setMonth((new Date).getMonth()-5)),"monthN"),end_monthN:(0,h.n7)(new Date,"month")});this.leaveDTLMonth=t.rows},async getLeaveDTL(){this.leaveDTL=[];const t=await u.K3({...this.$options.data().common,bu_code:this.selBu,begin_day:(0,h.n7)(new Date(this.selMonthN),"monthN")+"-01",end_day:(0,h.n7)(new Date(this.selMonthN),"monthN")+"-"+(0,h.y7)(this.selMonthN)});this.leaveDTL=t.rows},getName(t){return t.split(" ").map((t=>t[0])).join("")},formatter(t,e){return"year"===t?`${e}年`:"month"===t?`${e}月`:e},confirm(t){this.showMonth=!1,this.selMonth=(0,h.n7)(new Date(t),"month"),this.selMonthN=(0,h.n7)(new Date(t),"normalDay2"),this.getLeaveDTL()},onSelect(t){this.show=!1,this.selBu=t.value,this.getLeaveDTL()},getMonthyBar(t,e){const n=document.getElementById(t);if(!n)return!1;const s=this.$echarts.init(n,null,{devicePixelRatio:2});let a=[];for(let i in this.leaveDTLMonthItems)if(this.leaveDTLMonthItems.hasOwnProperty(i)){const e="sickBar"===t?"Sick Leave":"Annual Leave",n=this.leaveDTLMonthItems[i].filter((t=>t.leave_code===e)),s=n.map((t=>t.total_emp)).reduce(((t,e)=>t+e),0),o=s?(s/this.employeeList.length*100).toFixed(2):0;a.push({name:i,value:o})}let o,r=[];"monthyBar"===t?r=["#5579ED"]:"sickBar"===t&&(r=["#FF860F"]),o={tooltip:{alwaysShowContent:!1,trigger:"axis",axisPointer:{type:"shadow"}},color:r,legend:{},grid:{top:"7%",left:"3%",right:"5%",bottom:"6%",containLabel:!0},yAxis:{type:"value",splitNumber:3,axisLabel:{fontSize:"0",show:!1,color:"transparent"}},xAxis:{type:"category",data:this.getLastSixMonths(),axisTick:{alignWithLabel:!0,count:4},axisLabel:{color:"#666666",fontSize:"8"},axisLine:{lineStyle:{color:"#DBDFE8"}}},series:[{name:"",type:"bar",data:e?a.map((t=>t.value)):[],barWidth:"20",itemStyle:{borderRadius:[3,3,3,3]},label:{lineHeight:20,show:!0,formatter:"{c}%",position:"top",color:"#535353",fontSize:"12"}}]},o&&"object"===typeof o&&s.setOption(o),window.addEventListener("resize",s.resize)}}},d=m,v=n(845),p=(0,v.A)(d,s,a,!1,null,"9cf0aa74",null),g=p.exports},2407:function(t,e,n){n.d(e,{a5:function(){return i},n7:function(){return a},of:function(){return s},y7:function(){return o},zB:function(){return r}});n(4114);function s(t,e){const n=JSON.parse(JSON.stringify(t)),a=Object.keys(t);return a.forEach((a=>{-1!==[null,void 0,""].indexOf(n[a])?delete n[a]:e&&"object"===typeof t[a]&&!Array.isArray(t[a])&&(n[a]=s(n[a]))})),n}function a(t,e){if(!t)return"";const n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=["January","February","March","April","May","June","July","August","September","October","November","December"],a=new Date(t),o=a.getFullYear(),r=String(a.getMonth()+1).padStart(2,0),i=n[a.getMonth()],c=s[a.getMonth()],l=String(a.getDate()).padStart(2,0),h=String(a.getHours()).padStart(2,0),u=String(a.getMinutes()).padStart(2,0),m=String(a.getSeconds()).padStart(2,0);switch(e){case"slash":return`${o}/${r}/${l}`;case"year":return`${o}`;case"monthN":return`${o}-${r}`;case"monthLong":return`${o}-${c}`;case"month":return`${o}-${i}`;case"monthsh":return`${o}/${r}`;case"day":return`${l}-${r}-${o}`;case"timestamp":return`${o}${r}${l}${h}${u}`;case"obj":return{y:o,m:r,d:l,h:h,min:u,s:m};case"normal":return`${o}-${r}-${l} ${h}:${u}:${m}`;case"normalHours":return`${o}-${r}-${l} ${h}`;case"normalMin":return`${o}-${r}-${l} ${h}:${u}`;case"normalDay":return`${o}-${i}-${l}`;case"normalDay2":return`${o}-${r}-${l}`;default:return`${r}-${l}-${o} ${h}:${u}`}}const o=t=>{const e=new Date(t),n=e.getFullYear(),s=e.getMonth(),a=t=>t%4===0&&t%100!==0||t%400===0,o=[31,a(n)?29:28,31,30,31,30,31,31,30,31,30,31][s];return o},r=()=>{let t=["#73A0FA","#73DEB3","#7585A2","#F7C739","#EB7E65","#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc","#379392","#4F86C6","#4F86C6","#6C49B8","#67D5B5","#EE7785","#C89EC4","#84B1ED"];return t},i=t=>{const e=new Date,n=e.getFullYear(),s=e.getMonth(),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=["January","February","March","April","May","June","July","August","September","October","November","December"];let r=[];for(let i=5;i>=0;i--){const e=s-i<0?n-1:n,c=(s-i+12)%12,l=t?o[c]:a[c],h=`${e}-${l}`;r.push(h)}return r}},5683:function(t,e,n){t.exports=n.p+"img/icon_2.1636ef31.svg"},1042:function(t,e,n){t.exports=n.p+"img/icon_3.bc5359b7.svg"},597:function(t,e,n){t.exports=n.p+"img/select.566d2950.svg"},5513:function(t,e,n){t.exports=n.p+"img/icon_5.ccb06ef0.svg"}}]);